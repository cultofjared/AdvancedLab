\documentclass[justified, nobib]{tufte-handout}

\title{Data Analysis with Python}
\author{Jared Garst}
\date{\today} % remove title space

\usepackage{siunitx}

\newcommand{\ipythonTutorialLink}
  {http://ipython.readthedocs.org/en/stable/interactive/index.html}
\newcommand{\jupyterInfoLink}
  {http://jupyter-notebook.readthedocs.org/en/latest/notebook.html\#basic-workflow}
\newcommand{\anacondaLink}{https://store.continuum.io/cshop/anaconda/}
\newcommand{\email}{mailto:jgarst@ucdavis.edu}
\newcommand{\aboutUnicodeLink}
  {http://www.joelonsoftware.com/articles/Unicode.html}
\newcommand{\librariesLink}{http://www.scipy.org/index.html}
\newcommand{\customizeDirectoryLink}
  {http://stackoverflow.com/questions/15680463/change-ipython-working-directory}
\newcommand{\listTutorialLink}
  {https://docs.python.org/2/tutorial/datastructures.html}
\newcommand{\pintLink}{http://pint.readthedocs.org/en/0.6/}
\newcommand{\hgLink}{http://mercurial.selenic.com/}
\newcommand{\gitLink}{http://git-scm.com/}
\newcommand{\lambdaTutorialLink}
  {https://pythonconquerstheuniverse.wordpress.com/2011/08/29/lambda_tutorial/}
\newcommand{\functionalProgrammingLink}
  {http://www.ibm.com/developerworks/library/l-prog/}
\newcommand{\matplotlibGalleryLink}{http://matplotlib.org/gallery.html}

\newcommand{\myMarginNote}[3][-9px]{\marginnote{\centering{#2} \\ \vspace{#1}
\justify{#3}}}

\newcommand{\matplotlibGalleryNote}{\footnote{You will need the syntax for
      matplotlib. You can find everything with the help commands, or can get
      syntax and ideas from \href{\matplotlibGalleryLink}{example plots} that
      others have made.}}

\begin{document}
\maketitle
\bigskip

\noindent
Python is a high level scripting language.
While there are many reasons to like or dislike Python, we are introducing it to you because it is becoming the lingua franca of science.
\footnote{As an example, the recent LIGO result uses python for the analysis and Jupyter notebooks to present the \href{https://losc.ligo.org/s/events/GW150914/GW150914_tutorial.html}{data}.}
This means that increasingly you can expect other people to understand
your code, and for many of your problems to already be solved and documented in
Python.
Briefly, some exceptional Python features are:

\begin{description}
\item[Beautiful Syntax] \hfill \\
  Python will make your life easier, by encouraging simple, clean, easy to read
  code.
\item[Interpreted] \hfill \\
  The code you write is the code that runs. Nothing will be changed, nothing
  will be checked, nothing will be optimized.
\item[No Types] \hfill \\
  There is no easy way to specify how code will operate on your data.
\item[Program Control Through Indentation] \hfill \\
  Other languages use curly brackets \pythoninline{{}} to determine program
  flow, and tabs by convention for readability.
  Python conflates the two.
\item[Batteries Included] \hfill \\
  Python makes it easy to do common tasks, has an extensive set of additional
  libraries, and a vibrant community maintaining them.
\item[A Standard for Data Analysis] \hfill \\
  If you are analyzing data professionally, there are almost only two games in town: R and Python.
  Maybe Julia eventually.
\end{description}

\marginnote{There is good documentation available for both \href{\jupyterInfoLink}{Jupyter} and \href{\ipythonTutorialLink}{IPython}, if you are interested in becoming more expert in them.}
\noindent
IPython is an interactive version of python, designed for a more exploratory
approach to programming and analysis.
\sout{IPython} Jupyter notebooks allow you to quickly visualize your analysis,
and provide an easy record of your process.
We are nudging you towards these tools because they are some of the most universal and robust ways to analyze data --- but if there is a way that is easier for you use that instead.

\pagebreak

\section*{Setup and Startup}
There are two versions of Python that you will encounter in the wild, Python 2 and Python 3.
Python 3 is a take-no-prisoners reimagining of the the language.
The result is smoother, but breaks everything down to the print statement.
Most libraries support both Python 2 and 3, but most code is in Python 2.
This means the appropriate version will depend on how old your project is.
This introduction will use Python 3 --- but for this course there aren't huge differences between the choices.
If you have never set up a programming environment before, the easiest way to start is to install \href{\anacondaLink}{Anaconda}.

\smallskip
\noindent
Once you have completed the installation, run \textinline{ipython notebook} in the terminal, or the Anaconda IPython Notebook executable.
A web browser will automatically start with your notebook.
Managing directories in notebooks is clumsy.
Either make sure to run IPython in the directory you want, or \href{\customizeDirectoryLink}{change the default directory}.

\smallskip
\noindent
There are a few flavors of help commands available in IPython.
Familiarity with the options allows you to reference the manuals, or explore specific parts of the language.

\marginnote[25pt]{
\centering{help commands\\}
\begin{adjustwidth}{6.5em}{0pt}
    \input{help_commands}
\end{adjustwidth}
}

\begin{description}
\item[\pythoninline{help()}] is the native python help command.
Type \pythoninline{help()} into the first cell, and execute with shift-enter.
This is a good place to spend time getting familiar with the language, but you can also ask it about specific objects.
For example, run \pythoninline{help(list)} to see some common list manipulations.

\item[\textinline{?}] is IPython's own help command, and it is often nicer to use than \pythoninline{help}.
Try running \textinline{?} to see an introduction to IPython.
Like help you can also ask more specific commands, run \pythoninline{import numpy; numpy}\textinline{?} to see an overview of the exceptionally useful numpy module.
If you need all the gory details of an object, \pythoninline{numpy}\textinline{??} will give you the source code.

\item[\textinline{<regex>}\textinline{?}] allows you to use \textinline{?} to search through an object.
Try running \pythoninline{numpy.*cos*}\textinline{?} to see every function in numpy related to $\cos$.

\item[\PY{o}{\PYZpc{}}\pythoninline{quickref}] is a `magic function', unique to IPython. They are usually used to change the behavior of the notebook --- this one will list of all special IPython commands, including the magic functions.

\item[\textinline{<tab>}] will provide code completion.
Type \pythoninline{numpy.arc}\textinline{<tab>} and IPython will suggest a list of inverse trig functions.

\item[\textinline{Control-m h}] Provides a list of hotkeys for IPython notebooks.
If you spend a lot of time in the notebook, these are worth putting in your fingers.

\end{description}


\pagebreak
\section*{First Steps}
\input{first_example}

\pagebreak

\section*{Python Gotchas}
Some of the ways that python makes your life easier can send your program off
the rails, if you don't understand what the computer is doing.

\newthought{ZERO INDEXING} can lead you to be off by one in your lists.
\input{list.tex}

\begin{marginfigure}
    \def\svgwidth{140pt}{\input{indexing.pdf_tex}}
    \caption{%
    How to count in Python.
    Shaded elements correspond to those selected by indices [1:3]}
\label{fig:indexing}
\end{marginfigure}

\noindent
In early languages, you would access this data by moving to the collection, and reading from the position $(\text{data size}) \times (\text{data index})$.
Notice that in this scheme, the first element is zero and the last element is one less than the total number of elements.
Most languages still do this.

\input{zero_index.tex}

\noindent
To keep this straight, it helps to imagine the index as being located immediately before the element, as in Figure~\ref{fig:indexing}.

\smallskip

\newthought{MATPLOTLIB} is largely based on Matlab circa 2002, and sometimes feels like it. \href{https://stanford.edu/~mwaskom/software/seaborn/index.html}{Seaborn}, shown in Figure~\ref{fig:seaborn}, will make prettier plots.
Get it with \textinline{conda install seaborn} on the command line, though this won't make your code any less ugly.

\begin{marginfigure}
    \vspace*{\fill}
    \centering

    \def\svgwidth{140pt}\input{matplotlib_default.pdf_tex}

    \vspace*{\fill}
    \bigskip
    \def\svgwidth{140pt}\input{matplotlib_seaborn.pdf_tex}
  \caption{Matplotlib versus seaborn.
  \hspace{\textwidth}Remember to \pythoninline{import seaborn as sns}}
\label{fig:seaborn}
\end{marginfigure}

\noindent
One early example of clumsiness: histograms return bin edges, not bin centers.
It is easy to forget this, and add an offset to your analysis.
\sidenote[][2\baselineskip]{The real moral of this is to read the documentation.
\textinline{scipy.optimize.curve_fit} is another function that does not do exactly what you think it does.}

\input{bin_edges}

\vspace{5mm}
\newthought{TYPES} still exist in Python, even if you can't enforce them.
Consider the following Python~2 code:
\input{types}
\marginnote[0pt]{%
Int is an integer, float stand for `floating point number', otherwise known as a decimal number.
Though not usually relevant for data analysis, be aware that \pythoninline{int} and \pythoninline{float} have detailed differences in precision and speed.}
Python~3 is smarter about division, and will return $1.5$ for both calculations, but there are other places where Python will provide identical looking objects with distinct behavior.


\noindent
In the likely event that you cannot use Python~3, you can still import this behavior by including

\hspace{25pt}\pythoninline{from __future__ import division}

\noindent
at the top of your file or notebook.

\newthought{COPYING} can be done in two distinct ways, shown abstractly in Figure~\ref{fig:copy}.
A shallow copy will create another pointer to the same object, so that it can be used in a different part of the code.
A deep copy will create two distinct objects, so that you can have both an original and modified version.
Because the first case is common and the second case is expensive, Python copies the pointer by default.

\input{copying}

\begin{marginfigure}[-10\baselineskip]%
    \vspace*{\fill}
    \centering

    \def\svgwidth{75pt}\input{shallow_copy.pdf_tex}

    \vspace*{\fill}
    \bigskip
    \def\svgwidth{140pt}\input{deep_copy.pdf_tex}
  \caption{%
The finger pointing at the moon is not the moon}
\label{fig:copy}
\end{marginfigure}

\pagebreak

\newthought{THE NOTEBOOK STATE} is changed every time you run a command, not
every time you add a cell.
This allows you to create confusing code, by removing cells or executing them in a strange order.

\input{notebook_nonlinear}

\noindent
Try to keep your notebook linear, by not changing cells that have already successfully executed.

\newthought{FINITE PRECISION.}
There are infinite numbers between 0 and 1, but a finite amount of space on your computer.
That means you can't represent any real number, with some surprising results.

\marginnote[30pt]{You can't have everything.
Where would you put it?}
\input{finite_precision.tex}

\noindent
If you aren't implementing grungy low level numerical code, the real problem with finite precision is in comparisons.
\begin{pythoncode}
        float_sum = 0
        while float_sum != 1:
            float_sum += 0.1
            print('Infinite Loop!')
\end{pythoncode}
\begin{figure}[!hb]
\small
$$\underbrace{0}_{\text{sign}} \: \underbrace{01111111011}_{\text{exponent}} \: \underbrace{1001100110011001100110011001100110011001100110011010}_{\text{decimal}}$$
\caption{Binary representation of $0.1$. Note that $0.1$ is a repeating decimal in binary, so we will never be able to represent it precisely.}
\end{figure}
\pagebreak

\section*{Problems}

\newthought{DEAD TIME SIMULATION}

\noindent
Check your result on the dead time problem in the data analysis by simulating a poisson process.
Divide a period of at least \SI{20}{\micro\second} into bins of \SI{1}{\nano\second}. Put either zero or one photons in each bin with
\begin{pythoncode}
        np.random.choice([0, 1], num_bins, p=[prob_1, prob_2])
\end{pythoncode}
Find each photon and drop the events that occur in the subsequent dead time.
\begin{pythoncode}
        for photon_index in np.nonzero(bins)[0]:
            bins[dead_time_start:dead_time_end] = 0
\end{pythoncode}

\noindent
What is the efficiency of this detector?
What is the error on your answer?
What forms of systematic error are in this simulation?

\newthought{CENTRAL LIMIT THEOREM} \\
Plot a histogram of 10000 means, each averaging 10 numbers ranging from -0.5 to 0.5.
Generate a gaussian function with the same standard deviation, and plot the difference $(\text{y} - \text{gauss})$ and ratio $(\text{gauss} / \text{y})$.
Where is the absolute difference the greatest?
Where is the relative difference the greatest?
Describe the nature of the convergence in the center versus the tail of the distribution.

\newthought{DO IT YOURSELF POISSON DISTRIBUTION} \\
The poisson distribution predicts number of events per bin, when the events are time independent.
The probability of $k$ events, given an average of $\lambda$, is
$$ P(k) = \frac{\lambda^k e^{-\lambda}}{k!} $$

\marginnote{This problem originally from a job interview.
There is a market for the skills you learn in this lab.}
\noindent
Try implementing and plotting this yourself with a power (\pythoninline{u ** k}), exponent (\pythoninline{math.e ** u}), and factorial (\pythoninline{math.factorial(k)}).
What happens when you use values of $k$ greater than 200?
How would you make a poisson function that can calculate probabilities for large values of $k$?
\pagebreak

\section*{More Reading}
\begin{description}
\item \href{http://www.jesshamrick.com/2016/04/13/reproducible-plots/}{Publication quality figures from Matplotlib and Seaborn.}

\item \href{http://learnpythonthehardway.org/book/}{A more comprehensive guide to learning Python.}

\item \href{\listTutorialLink}{Data Structures and List Manipulation.}

\item \href{\pintLink}{Units and Errors.}

\item Source control: \href{\gitLink}{Git} and \href{\hgLink}{Mercurial}.

%\item \href{\lambdaTutorialLink}{Lambda Functions} and
%  \href{\functionalProgrammingLink}{Functional programming}

\end{description}
\end{document}
